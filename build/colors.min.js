(function(){var z,B,C,D;C=function(a,k,e,g,t,n){var p,d,b,c,E;null==n&&(n=8);a=a.getContext("2d").getImageData(k,e,g,t).data;d=[];b=c=e;for(e+=t;c<e;b=c+=1)for(t=b*g*4,p=b=k,E=k+g;b<E;p=b+=1)p=t+4*p,d.push([a[p],a[p+1],a[p+2]]);return(new MMCQ).B(d,n)};B=function(a,k){var e;e=function(a){return a*a};return e(a[0]-k[0])+e(a[1]-k[1])+e(a[2]-k[2])};D=function(a){var k,e,g,t,n;k=function(a){a=a.toString(16);return 2>a.length?a+"0":a};n=[];g=0;for(t=a.length;g<t;g++)e=a[g],n.push(e.map(k).join(""));return n};
this.color=function(a,k){var e,g;null==a&&(a="palette-image");g=new Image;g.src=document.getElementById(a).src;e=document.createElement("canvas");return window.onload=function(){var a,n,p,d;g.height=g.width=36;e.width=g.width;e.height=g.height;e.getContext("2d").drawImage(g,0,0,g.width,g.height);d=C(e,0,0,g.width,g.height,10).a.map(function(b){return{count:b.q.count(),l:b.color}});d.sort(function(b,c){return c.count-b.count});a=d.shift().l;p=function(b){return B(a,b.l)};d.sort(function(b,c){return p(c)-
p(b)});n=d.shift().l;d=d.shift().l;n=D([a,n,d]);if(k)return k(n)}};z=function(){function a(a){this.v=a;this.i=[];this.m=!1}a.prototype.sort=function(){this.i.sort(this.v);return this.m=!0};a.prototype.push=function(a){this.i.push(a);return this.m=!1};a.prototype.j=function(a){null==a&&(a=this.i.length-1);this.m||this.sort();return this.i[a]};a.prototype.pop=function(){this.m||this.sort();return this.i.pop()};a.prototype.size=function(){return this.i.length};a.prototype.map=function(a){return this.i.map(a)};
return a}();(function(){function a(){this.r=1E3;this.w=0.75}var k,e,g,t,n,p;a.k=5;a.h=8-a.k;t=function(d,b,c){return(d<<2*a.k)+(b<<a.k)+c};k=function(){function d(b,c,a,d,h,f,m){this.f=b;this.g=c;this.d=a;this.e=d;this.b=h;this.c=f;this.n=m}d.prototype.volume=function(b){if(!this.p||b)this.p=(this.g-this.f+1)*(this.e-this.d+1)*(this.c-this.b+1);return this.p};d.prototype.count=function(b){var c,a,d,h,f,m,r,q,s;if(!this.t||b){a=0;d=h=this.f;for(r=this.g;h<=r;d=h+=1)for(b=f=this.d,q=this.e;f<=q;b=f+=
1)for(c=m=this.b,s=this.c;m<=s;c=m+=1)c=t(d,b,c),a+=this.n[c]||0;this.t=!0;this.s=a}return this.s};d.prototype.copy=function(){return new d(this.f,this.g,this.d,this.e,this.b,this.c,this.n)};d.prototype.u=function(){var b,c,d,l,h,f,m,r,q,s,u,A,g,e,k;if(!this.o){f=1<<8-a.k;c=l=r=q=0;m=s=this.f;for(g=this.g;s<=g;m=s+=1)for(d=u=this.d,e=this.e;u<=e;d=u+=1)for(b=A=this.b,k=this.c;A<=k;b=A+=1)h=t(m,d,b),h=this.n[h]||0,q+=h,r+=h*(m+0.5)*f,l+=h*(d+0.5)*f,c+=h*(b+0.5)*f;this.o=q?[~~(r/q),~~(l/q),~~(c/q)]:
[~~(f*(this.f+this.g+1)/2),~~(f*(this.d+this.e+1)/2),~~(f*(this.b+this.c+1)/2)]}return this.o};d.prototype.contains=function(b){var c,d;d=b[0]>>a.h;c=b[1]>>a.h;b=b[2]>>a.h;return this.f<=d&&d<=this.g&&this.d<=c&&c<=this.e&&this.b<=b&&b<=this.c};return d}();e=function(){function a(){this.a=new z(function(b,a){var d,l;d=b.count()*b.volume();l=a.count()*a.volume();return d>l?1:d<l?-1:0})}a.prototype.push=function(b){return this.a.push({q:b,color:b.u()})};a.prototype.size=function(){return this.a.size()};
a.prototype.map=function(b){var a;for(a=this.a.size();0<a;)return this.a.j(0).q.contains(b)?this.a.j(0).color:this.A(b)};a.prototype.a=function(){return this.a};a.prototype.A=function(b){var a,d,l,h,f,m,r;f=function(b){return b*b};l=1E9;d=m=0;for(r=this.a.size();m<r;d=m+=1)a=Math.sqrt(f(b[0]-this.a.j(d).color[0])+f(b[1]-this.a.j(d).color[1])+f(b[2]-this.a.j(d).color[2])),a<l&&(l=a,h=this.a.j(d).color);return h};return a}();n=function(d){var b,c,g,l,h,f;g=Array(1<<3*a.k);h=0;for(f=d.length;h<f;h++)b=
d[h],l=b[0]>>a.h,c=b[1]>>a.h,b=b[2]>>a.h,c=t(l,c,b),g[c]=(g[c]||0)+1;return g};g=function(d,b){var c,g,l,h,f,m,r,q,s,u,e;s=1E6;q=0;m=1E6;f=0;l=1E6;u=g=0;for(e=d.length;u<e;u++)c=d[u],r=c[0]>>a.h,h=c[1]>>a.h,c=c[2]>>a.h,r<s?s=r:r>q&&(q=r),h<m?m=h:h>f&&(f=h),c<l?l=c:c>g&&(g=c);return new k(s,q,m,f,l,g,b)};p=function(a,b){var c,g,l,h,f,m,r,q,s,u,e,k,n,p,v,w,x,y;if(b.count()){if(1===b.count())return[b.copy()];u=b.g-b.f+1;h=b.e-b.d+1;g=b.c-b.b+1;r=Math.max(u,h,g);k=0;q=[];m=[];if(r===u)for(s=n=b.f,w=b.g;n<=
w;s=n+=1){e=0;l=p=b.d;for(x=b.e;p<=x;l=p+=1)for(c=v=b.b,y=b.c;v<=y;c=v+=1)f=t(s,l,c),e+=a[f]||0;k+=e;q[s]=k}else if(r===h)for(l=n=b.d,x=b.e;n<=x;l=n+=1){e=0;s=p=b.f;for(y=b.g;p<=y;s=p+=1)for(c=v=b.b,w=b.c;v<=w;c=v+=1)f=t(s,l,c),e+=a[f]||0;k+=e;q[l]=k}else for(c=n=b.b,w=b.c;n<=w;c=n+=1){e=0;s=p=b.f;for(x=b.g;p<=x;s=p+=1)for(l=v=b.d,y=b.e;v<=y;l=v+=1)f=t(s,l,c),e+=a[f]||0;k+=e;q[c]=k}q.forEach(function(b,a){return m[a]=k-b});c=function(a){var c,d,e,f,g,h;g=a+"1";a+="2";e=c=b[g];for(d=b[a];c<=d;e=c+=
1)if(q[e]>k/2){c=b.copy();d=b.copy();f=e-b[g];h=b[a]-e;for(f=f<=h?Math.min(b[a]-1,~~(e+h/2)):Math.max(b[g],~~(e-1-f/2));!q[f];)f++;for(e=m[f];!e&&q[f-1];)e=m[--f];c[a]=f;d[g]=c[a]+1;return[c,d]}};if(r===u)return c("r");if(r===h)return c("g");if(r===g)return c("b")}};a.prototype.B=function(a,b){var c,k,l,h,f,m=this;if(!a.length||2>b||256<b)return console.log("invalid arguments"),!1;l=n(a);c=g(a,l);h=new z(function(a,b){var c,d;c=a.count();d=b.count();return c>d?1:c<d?-1:0});h.push(c);k=function(a,
b){var d,e,f,g;f=1;for(g=0;g<m.r;)if(c=a.pop(),c.count()){e=p(l,c);d=e[0];e=e[1];if(!d){console.log("cbox1 not defined; shouldn't happen");break}a.push(d);e&&(a.push(e),f++);if(f>=b)break;if(g++>m.r){console.log("infinite loop; perhaps too few pixels");break}}else a.push(c),g++};k(h,this.w*b);for(f=new z(function(a,b){var c,d;c=a.count()*a.volume();d=b.count()*b.volume();return c>d?1:c<d?-1:0});h.size();)f.push(h.pop());k(f,b-f.size());for(k=new e;f.size();)k.push(f.pop());return k};return a}).call(this)}).call(this);
